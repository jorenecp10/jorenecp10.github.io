<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Formulario con firma</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

</head>
<body>
 
    <div class="container my-5">
        <div class="row justify-content-center">
          <div class="col-lg-8 col-12">
            <h2 class="text-center mb-4">Formulario con firma</h2>
            <form>
              <div class="form-group">
                <label for="nombre">Nombre</label>
                <input type="text" class="form-control" id="nombre" required>
              </div>
              <div class="form-group">
                <label for="apellido">Apellido</label>
                <input type="text" class="form-control" id="apellido" required>
              </div>
              <div class="form-group">
                <label for="email">Correo electrónico</label>
                <input type="email" class="form-control" id="email" required>
              </div>
              <div class="form-group">
                <label>Firma</label>
                <canvas id="canvas" style="border: 1px solid #000;"></canvas>
              </div>
              <button type="submit" class="btn btn-primary btn-sm">Enviar</button>
              <button id="canvas-clear" type="button" class="btn btn-secondary btn-sm">Borrar firma</button>
            </form>
          </div>
        </div>
      </div>
      

      <script>
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
     
        // Configurar el canvas
        canvas.width = 500;
        canvas.height = 200;
        ctx.lineWidth = 2;
        ctx.lineCap = "round";
        ctx.strokeStyle = "#000";
     
        let isDrawing = false;
        let points = [];
     
        // Eventos para dibujar en el canvas
        canvas.addEventListener("mousedown", function(e) {
           isDrawing = true;
           points.push({
              x: e.offsetX,
              y: e.offsetY
           });
        });
     
        canvas.addEventListener("mousemove", function(e) {
           if (!isDrawing) return;
           points.push({
              x: e.offsetX,
              y: e.offsetY
           });
     
           ctx.beginPath();
           ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);
           ctx.lineTo(points[points.length - 1].x, points[points.length - 1].y);
           ctx.stroke();
        });
     
        canvas.addEventListener("mouseup", function(e) {
           isDrawing = false;
        });
     
        canvas.addEventListener("touchstart", function(e) {
           e.preventDefault();
           isDrawing = true;
           points.push({
              x: e.touches[0].clientX - canvas.offsetLeft,
              y: e.touches[0].clientY - canvas.offsetTop
           });
        });
     
        canvas.addEventListener("touchmove", function(e) {
           e.preventDefault();
           if (!isDrawing) return;
           points.push({
              x: e.touches[0].clientX - canvas.offsetLeft,
              y: e.touches[0].clientY - canvas.offsetTop
           });
     
           ctx.beginPath();
           ctx.moveTo(points[points.length - 2].x, points[points.length - 2].y);
           ctx.lineTo(points[points.length - 1].x, points[points.length - 1].y);
           ctx.stroke();
        });
     
        canvas.addEventListener("touchend", function(e) {
           e.preventDefault();
           isDrawing = false;
        });
     
        // Evento para borrar la firma
        $("#canvas-clear").on("click", function() {
           points = [];
           ctx.clearRect(0, 0, canvas.width, canvas.height);
        });
     
        // Evento para enviar el formulario
        $("form").submit(function(e) {
           e.preventDefault();
     
           // Obtener los valores de los campos del formulario
           const nombre = $("#nombre").val();
           const apellido = $("#apellido").val();
           const email = $("#email").val();
     
           // Convertir la firma en una imagen en formato base64
           const signatureImage = canvas.toDataURL();
     
           // Enviar la imagen a imgBB
           $.ajax({
              url: "https://api.imgbb.com/1/upload",
              type: "POST",
              data: {
                 key: "1f8d554d874fe24be3792dbabff76be8", // Reemplazar con tu API Key de imgBB
                 image: signatureImage.split(",")[1]
              },
              dataType: "json",
              success: function(response) {
                 // Crear el objeto que se enviará a SheetDB con la URL de la imagen
                 const formData = {
                    nombre: nombre,
                    apellido: apellido,
                    email: email,
                    firma: response.data.url
                 };
  
          // Enviar los datos a SheetDB
          $.ajax({
            url: "https://sheetdb.io/api/v1/dp6isyxc0f0nh",
            type: "POST",
            data: formData,
            dataType: "json",
            success: function(response) {
              Swal.fire({
                icon: "success",
                title: "Formulario enviado",
                text: "Los datos han sido enviados correctamente"
              });
  
              // Limpiar el formulario y la firma
              $("#nombre").val("");
              $("#apellido").val("");
              $("#email").val("");
              points = [];
              ctx.clearRect(0, 0, canvas.width, canvas.height);
            },
            error: function(error) {
              console.error(error);
              Swal.fire({
                icon: "error",
                title: "Error",
                text: "Ha ocurrido un error al enviar los datos"
              });
            }
          });
        },
        error: function(error) {
          console.error(error);
          Swal.fire({
            icon: "error",
            title: "Error",
            text: "Ha ocurrido un error al cargar la imagen"
          });
        }
      });
    });
  </script>
  
  
        
  
</body>
</html>